# BalancedHierarchy シナリオ

## 目的

**負荷の順序を最適化: SeniorManager > Director > CXO ≈ Manager**

## 戦略

各階層の子ノード数を調整し、「挟まれ効果」を活用して理想的な負荷分布を実現します。

### 目標負荷順序

```
SeniorManager (最高)
    ↓ -10~15%
Director (2番目)
    ↓ -40~50%
CXO ≈ Manager (低く抑える)
```

---

## CHILD_RANGES 設定

```python
CHILD_RANGES = {
    "CXO": (5, 8),           # ★ 少なめ → 低負荷
    "Director": (12, 15),    # ★ 多め → 高負荷（2番目）
    "SeniorManager": (6, 9),  # ★ 中程度 → 最高負荷
    "Manager": (3, 5),        # ★ 少なめ → 低負荷
    "Player": (0, 0),
}
```

---

## 設計の根拠

### 1. **SeniorManagerを最高負荷に**（6-9人管理）

#### 挟まれ効果
- **上層から**: Directorからタスクが流れてくる
- **下層から**: 6-9人のManagerから報告を受け取る
- **位置的特性**: 中間層として上下両方から負荷を受ける

#### 負荷の構成
- タスク受信: 上層からの大量のタスク
- タスク分割・送信: 複数の子ノードへ配分
- 報告受信: 6-9人 × 0.1 × タスク重み

---

### 2. **Directorを2番目に**（12-15人管理）

#### 報告受信負荷
- **多くのSeniorManager**（12-15人）から報告を受け取る
- 報告受信負荷: 12-15人 × 0.1 × タスク重み = 高負荷

#### 上流効果
- CXOの直下なので、上からのタスク流入は少ない
- 主な負荷源は「報告受信」

---

### 3. **Managerを低く抑える**（3-5人管理）

#### 負荷削減
- **少数のPlayer**（3-5人）のみ管理
- 報告受信負荷が最小化
- ReducedSeniorSpanの問題（Manager負荷増）を解決

#### 役割
- タスクの実行指示が主
- 報告受信は限定的

---

### 4. **CXOを低く抑える**（5-8人管理）

#### 最上層の利点
- **上からのタスクがない**（生成タスクのみ）
- 少数のDirector（5-8人）のみ管理
- 報告受信負荷が限定的

---

## 他シナリオとの比較

### CHILD_RANGES比較表

| シナリオ | CXO | Director | SeniorManager | Manager | 狙い |
|---------|----:|----------|---------------|---------|------|
| **InterviewBased** | 15-20 | 10-15 | 10-15 | 5-10 | 実務データ |
| **ReducedSeniorSpan** | 15-20 | 10-15 | **3-5** | **8-12** | SeniorManager削減 |
| **BalancedHierarchy** | **5-8** | **12-15** | **6-9** | **3-5** | 負荷順序最適化 |

### 負荷順序の比較

| シナリオ | 1位 | 2位 | 3位 | 4位 | 5位 |
|---------|-----|-----|-----|-----|-----|
| InterviewBased | SM (94,420) | Dir (70,990) | Mgr (64,903) | CXO (47,789) | - |
| ReducedSeniorSpan | **Mgr (76,178)** ❌ | SM (72,127) | Dir (57,607) | CXO (36,762) | - |
| **BalancedHierarchy** | **SM (目標)** ✅ | **Dir (目標)** ✅ | **CXO≈Mgr** ✅ | - | - |

---

## 期待される結果

### 目標値（推定）

| 役職 | InterviewBased | BalancedHierarchy（目標） | 改善率 |
|------|---------------:|-------------------------:|---------:|
| SeniorManager | 94,420 | **75,000-85,000** | -10~20% |
| Director | 70,990 | **68,000-77,000** | -5~+10% |
| Manager | 64,903 | **40,000-50,000** | -23~-38% |
| CXO | 47,789 | **40,000-50,000** | -16~+5% |

### 負荷順序（目標）

```
✅ SeniorManager (75,000-85,000)
✅ Director (68,000-77,000)
✅ CXO ≈ Manager (40,000-50,000)
```

---

## 負荷メカニズム図

```
CXO (5-8人)
  │ タスク生成
  │ 報告受信: 少ない（5-8人分）
  ↓
Director (12-15人) ← 多くのSeniorManagerから報告（高負荷）
  │ タスク流入
  │ 報告受信: 多い（12-15人分）
  ↓
SeniorManager (6-9人) ← 上下から挟まれる（最高負荷）★
  │ タスク受信 + 分割
  │ 報告受信: 中程度（6-9人分）
  ↓
Manager (3-5人) ← 報告少ない（低負荷）
  │ タスク実行指示
  │ 報告受信: 少ない（3-5人分）
  ↓
Player ← 実行のみ
```

---

## 実行方法

```bash
# シミュレーション実行
python -m newSimulations.forThesis.BalancedHierarchy.graph_simulation

# 結果の可視化
python -m newSimulations.forThesis.BalancedHierarchy.visualize_results

# レポート更新
python -m newSimulations.forThesis.BalancedHierarchy.refresh_report
```

---

## 成功基準

### 1. 負荷順序の達成
```
SeniorManager > Director > (CXO ≈ Manager)
```

### 2. SeniorManagerとDirectorの差
- **10-15%程度**の差が理想
- 差が大きすぎない（組織全体のバランス）

### 3. CXOとManagerが同レベル
- 両者の差が **±10%以内**

### 4. 全体の最高負荷削減
- InterviewBased (94,420) より **10%以上削減**

---

## 理論的背景

### 「挟まれ効果」の活用

中間層（SeniorManager）が最も負荷が高くなる理由：

1. **上層からのタスク流入**
   - Directorから多様なタスクが降りてくる
   - タスクの分割・判断が必要

2. **下層への配分負荷**
   - 6-9人のManagerへタスクを配分
   - 分割コスト: 0.2 × タスク重み
   - 送信コスト: 0.3 × タスク重み

3. **下層からの報告受信**
   - 6-9人のManagerから報告
   - 報告受信コスト: 0.1 × タスク重み × 人数

この3つの負荷が重なり、SeniorManagerが最高負荷となる。

### Directorが2番目になる理由

- 上流なので、上からのタスク流入は少ない
- しかし、**12-15人のSeniorManager**から報告を受ける
- 報告受信負荷がメイン（0.1 × タスク重み × 12-15）

### ManagerとCXOが低い理由

- **Manager**: 子ノード数が少ない（3-5人）→ 報告受信負荷が小さい
- **CXO**: 最上層で上からのタスクがない + 子数が少ない（5-8人）

---

## 次のステップ

1. **シミュレーション実行**
2. **InterviewBasedとの比較**
3. **負荷順序の確認**
4. **論文への反映**

目標負荷順序が達成できたら、組織設計の「最適解」として提案可能！
